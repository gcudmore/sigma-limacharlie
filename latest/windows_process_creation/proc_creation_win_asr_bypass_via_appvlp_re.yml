detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: appvlp.exe
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: cmd.exe
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: powershell.exe
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .sh
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .exe
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .dll
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .bin
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .bat
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .cmd
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .js
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .msh
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .reg
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .scr
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .ps
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .vb
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .jar
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .pl
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: '.inf'
respond:
- action: report
  metadata:
    author: Sreeman
    description: 'Application Virtualization Utility is included with Microsoft Office.
      We are able to abuse "AppVLP" to execute shell commands.

      Normally, this binary is used for Application Virtualization, but we can use
      it as an abuse binary to circumvent the ASR file path rule folder

      or to mark a file as a system file.

      '
    falsepositives:
    - Unknown
    level: medium
    tags:
    - attack.t1218
    - attack.defense_evasion
    - attack.execution
  name: Using AppVLP To Circumvent ASR File Path Rule

