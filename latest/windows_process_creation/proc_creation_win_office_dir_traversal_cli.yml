detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: or
      rules:
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \winword.exe
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \excel.exe
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \powerpnt.exe
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \msaccess.exe
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \mspub.exe
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \eqnedt32.exe
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \visio.exe
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/FILE_PATH
        value: \Windows\System32\
      - case sensitive: false
        op: contains
        path: event/FILE_PATH
        value: \Windows\SysWOW64\
    - op: or
      rules:
      - case sensitive: false
        op: is
        path: event/COMMAND_LINE
        value: ../../../..
      - case sensitive: false
        op: is
        path: event/COMMAND_LINE
        value: ..\..\..\..
      - case sensitive: false
        op: is
        path: event/COMMAND_LINE
        value: ..//..//..//..
respond:
- action: report
  metadata:
    author: '@SBousseaden (idea), Christian Burkard (rule)'
    description: Detects Office Applications executing a Windows child process including
      directory traversal patterns
    falsepositives:
    - Unknown
    level: high
    references:
    - https://twitter.com/sbousseaden/status/1531653369546301440
    tags:
    - attack.execution
    - attack.defense_evasion
  name: Office Directory Traversal CommandLine

