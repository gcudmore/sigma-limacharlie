detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: or
    rules:
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/FILE_PATH
        value: windows\system32\Physmem.sys
      - op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/FILE_PATH
          value: Windows\system32\ime\SHARED\WimBootConfigurations.ini
        - case sensitive: false
          op: contains
          path: event/FILE_PATH
          value: Windows\system32\ime\IMEJP\WimBootConfigurations.ini
        - case sensitive: false
          op: contains
          path: event/FILE_PATH
          value: Windows\system32\ime\IMETC\WimBootConfigurations.ini
    - op: and
      rules:
      - op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/FILE_PATH
          value: windows\system32\filepath2
        - case sensitive: false
          op: contains
          path: event/FILE_PATH
          value: windows\system32\ime
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: reg add
      - op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: HKEY_LOCAL_MACHINE\software\classes\clsid\{7c857801-7381-11cf-884d-00aa004b2e24}\inprocserver32
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: HKEY_LOCAL_MACHINE\software\classes\clsid\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\inprocserver32
respond:
- action: report
  metadata:
    author: MSTIC, FPT.EagleEye
    description: Suspicious behaviours related to an actor tracked by Microsoft as
      SOURGUM
    falsepositives:
    - Unknown
    level: high
    references:
    - https://www.virustotal.com/gui/file/c299063e3eae8ddc15839767e83b9808fd43418dc5a1af7e4f44b97ba53fbd3d/detection
    - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/MultipleDataSources/SOURGUM_IOC.yaml
    - https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/
    tags:
    - attack.t1546
    - attack.t1546.015
    - attack.persistence
    - attack.privilege_escalation
  name: SOURGUM Actor Behaviours

