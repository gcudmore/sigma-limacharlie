detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: or
    rules:
    - op: or
      rules:
      - op: and
        rules:
        - op: and
          rules:
          - case sensitive: false
            op: ends with
            path: event/FILE_PATH
            value: \svchost.exe
          - case sensitive: false
            op: contains
            path: event/COMMAND_LINE
            value: C:\Users\
          - case sensitive: false
            op: contains
            path: event/COMMAND_LINE
            value: \Desktop\
        - case sensitive: false
          not: true
          op: starts with
          path: event/PARENT/FILE_PATH
          value: C:\Windows\System32\
      - op: and
        rules:
        - op: and
          rules:
          - case sensitive: false
            op: ends with
            path: event/PARENT/FILE_PATH
            value: \excel.exe
          - case sensitive: false
            op: ends with
            path: event/FILE_PATH
            value: \regsvr32.exe
          - op: or
            rules:
            - case sensitive: false
              op: contains
              path: event/COMMAND_LINE
              value: ' -s '
            - case sensitive: false
              op: contains
              path: event/COMMAND_LINE
              value: \AppData\Local\Temp\
        - case sensitive: false
          not: true
          op: contains
          path: event/COMMAND_LINE
          value: .dll
    - op: and
      rules:
      - case sensitive: false
        op: ends with
        path: event/PARENT/FILE_PATH
        value: \svchost.exe
      - op: or
        rules:
        - op: and
          rules:
          - case sensitive: false
            op: ends with
            path: event/FILE_PATH
            value: \whoami.exe
          - case sensitive: false
            op: contains
            path: event/COMMAND_LINE
            value: ' /all'
        - op: and
          rules:
          - op: or
            rules:
            - case sensitive: false
              op: ends with
              path: event/FILE_PATH
              value: \net.exe
            - case sensitive: false
              op: ends with
              path: event/FILE_PATH
              value: \net1.exe
          - case sensitive: false
            op: contains
            path: event/COMMAND_LINE
            value: ' view'
respond:
- action: report
  metadata:
    author: Florian Roth (Nextron Systems), oscd.community, Nasreddine Bencherchali
      (Nextron Systems)
    description: Detects potential Dridex acitvity via specific process patterns
    falsepositives:
    - Unlikely
    level: critical
    references:
    - https://app.any.run/tasks/993daa5e-112a-4ff6-8b5a-edbcec7c7ba3
    - https://redcanary.com/threat-detection-report/threats/dridex/
    tags:
    - attack.defense_evasion
    - attack.privilege_escalation
    - attack.t1055
    - attack.discovery
    - attack.t1135
    - attack.t1033
  name: Potential Dridex Activity

