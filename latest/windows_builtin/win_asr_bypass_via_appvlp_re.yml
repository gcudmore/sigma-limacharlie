detect:
  log type: wel
  op: and
  rules:
  - case sensitive: false
    op: contains
    path: Event/EventData/CommandLine
    value: appvlp.exe
  - op: or
    rules:
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: cmd.exe
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: powershell.exe
  - op: or
    rules:
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .sh
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .exe
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .dll
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .bin
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .bat
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .cmd
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .js
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .msh
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .reg
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .scr
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .ps
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .vb
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .jar
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: .pl
    - case sensitive: false
      op: contains
      path: Event/EventData/CommandLine
      value: '.inf'
  target: log
respond:
- action: report
  metadata:
    author: Sreeman
    description: 'Application Virtualization Utility is included with Microsoft Office.
      We are able to abuse "AppVLP" to execute shell commands.

      Normally, this binary is used for Application Virtualization, but we can use
      it as an abuse binary to circumvent the ASR file path rule folder

      or to mark a file as a system file.

      '
    falsepositives:
    - unknown
    level: medium
    tags:
    - attack.t1218
    - attack.defense_evasion
    - attack.execution
  name: Using AppVLP To Circumvent ASR File Path Rule

