detect:
  event: WEL
  op: and
  rules:
  - op: is windows
  - op: or
    rules:
    - op: and
      rules:
      - case sensitive: false
        op: is
        path: event/EVENT/EventData/Provider_Name
        value: Microsoft-Windows-Kerberos-Key-Distribution-Center
      - op: or
        rules:
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '35'
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '36'
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '37'
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '38'
    - op: and
      rules:
      - case sensitive: false
        op: is
        path: event/EVENT/EventData/Provider_Name
        value: Microsoft-Windows-Directory-Services-SAM
      - op: or
        rules:
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '16990'
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '16991'
respond:
- action: report
  metadata:
    author: frack113
    description: 'The attacker creates a computer object using those permissions with
      a password known to her.

      After that she clears the attribute ServicePrincipalName on the computer object.

      Because she created the object (CREATOR OWNER), she gets granted additional
      permissions and can do many changes to the object.

      '
    falsepositives:
    - Unknown
    level: medium
    references:
    - https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/
    tags:
    - attack.credential_access
    - attack.t1558.003
  name: Exploit SamAccountName Spoofing with Kerberos

